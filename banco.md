CREATE TYPE "user_app_role" AS ENUM (
'admin',
'host',
'doctor',
'reception',
'guest'
);

CREATE TYPE "appointment_type" AS ENUM (
'consulta',
'retorno',
'exame',
'procedimento',
'bloqueio'
);

CREATE TYPE "appointment_status" AS ENUM (
'agendado',
'confirmado',
'em_andamento',
'concluido',
'cancelado',
'falta'
);

CREATE TYPE "appointment_source" AS ENUM (
'whatsapp_ia',
'whatsapp_manual',
'telefone',
'presencial',
'instagram',
'website',
'outro'
);

CREATE TYPE "patient_gender" AS ENUM (
'Masculino',
'Feminino',
'Outro'
);

CREATE TYPE "doctor_gender" AS ENUM (
'Masculino',
'Feminino',
'Outro',
'Prefiro não informar'
);

CREATE TYPE "clinic_user_role" AS ENUM (
'owner',
'admin',
'reception',
'doctor'
);

CREATE TYPE "clinic_subscription_plan" AS ENUM (
'trial',
'basic',
'premium',
'enterprise'
);

CREATE TYPE "user_api_key_status" AS ENUM (
'active',
'revoked'
);

CREATE TYPE "audit_log_action" AS ENUM (
'create',
'update',
'delete',
'login',
'logout',
'invite',
'switch_clinic'
);

CREATE TYPE "newsletter_subscriber_status" AS ENUM (
'active',
'unsubscribed'
);

CREATE TYPE "exam_status" AS ENUM (
'active',
'archived'
);

CREATE TYPE "user_registration_role" AS ENUM (
'host'
);

CREATE TYPE "registration_status" AS ENUM (
'pending',
'approved',
'rejected'
);

CREATE TABLE "users" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"email" varchar(255) UNIQUE NOT NULL,
"full_name" varchar(255) NOT NULL,
"password_hash" varchar(255) NOT NULL,
"app_role" user_app_role NOT NULL,
"last_login" timestamp,
"first_login" boolean NOT NULL DEFAULT true,
"is_active" boolean NOT NULL DEFAULT true,
"host_user_id" integer,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "clinics" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" varchar(255) NOT NULL,
"cnpj" varchar(20) UNIQUE NOT NULL,
"phone" varchar(50),
"email" varchar(255) UNIQUE,
"settings" jsonb,
"subscription_plan" clinic_subscription_plan NOT NULL DEFAULT 'trial',
"is_active" boolean NOT NULL DEFAULT true,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "clinic_addresses" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"clinic_id" integer NOT NULL,
"street" varchar(255) NOT NULL,
"number" varchar(50),
"city" varchar(255) NOT NULL,
"state" varchar(50) NOT NULL,
"zip_code" varchar(20),
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "doctors" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" integer UNIQUE NOT NULL,
"clinic_id" integer NOT NULL,
"full_name" varchar(255) NOT NULL,
"cpf" varchar(20) UNIQUE,
"birth_date" date,
"gender" doctor_gender,
"languages" jsonb,
"council_type" varchar(50) NOT NULL,
"council_number" varchar(50) UNIQUE NOT NULL,
"council_state" varchar(10) NOT NULL,
"main_specialty" varchar(255) NOT NULL,
"sub_specialties" jsonb,
"email" varchar(255) UNIQUE NOT NULL,
"phone" varchar(50) NOT NULL,
"landline" varchar(50),
"services" jsonb,
"accepted_insurances" jsonb,
"availability_schedule" jsonb,
"has_system_access" boolean NOT NULL DEFAULT false,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "patients" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"clinic_id" integer NOT NULL,
"full_name" varchar(255) NOT NULL,
"cpf" varchar(20) UNIQUE NOT NULL,
"birth_date" date,
"gender" patient_gender,
"phone" varchar(50),
"email" varchar(255),
"medical_plan" varchar(255),
"allergies" jsonb,
"chronic_conditions" jsonb,
"current_medications" jsonb,
"surgeries" jsonb,
"hospitalizations" jsonb,
"family_medical_history" text,
"is_active" boolean NOT NULL DEFAULT true,
"owning_host_id" integer,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "patient_addresses" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"patient_id" integer NOT NULL,
"street" varchar(255) NOT NULL,
"number" varchar(50),
"city" varchar(255) NOT NULL,
"state" varchar(50) NOT NULL,
"zip_code" varchar(20),
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "emergency_contacts" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"patient_id" integer NOT NULL,
"name" varchar(255) NOT NULL,
"phone" varchar(50) NOT NULL,
"relationship" varchar(100),
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "exams" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" varchar(255) UNIQUE NOT NULL,
"category" varchar(255),
"instructions" text,
"notes" text,
"price" decimal(10,2) NOT NULL,
"duration" integer DEFAULT 30,
"status" exam_status NOT NULL DEFAULT 'active',
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "appointments" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"patient_id" integer NOT NULL,
"doctor_id" integer NOT NULL,
"clinic_id" integer NOT NULL,
"exam_id" integer,
"starts_at" timestamp NOT NULL,
"ends_at" timestamp NOT NULL,
"duration" integer NOT NULL DEFAULT 30,
"type" appointment_type NOT NULL,
"status" appointment_status NOT NULL,
"source" appointment_source NOT NULL DEFAULT 'presencial',
"specialty" varchar(255),
"special_needs" text,
"whatsapp_thread" varchar(255),
"reminder_sent" boolean NOT NULL DEFAULT false,
"cancellation_reason" text,
"cancelled_by" integer,
"notes" text,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "medical_records" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"patient_id" integer NOT NULL,
"doctor_id" integer NOT NULL,
"clinic_id" integer NOT NULL,
"appointment_id" integer,
"consultation_date" date NOT NULL,
"chief_complaint" text,
"history_present_illness" text,
"physical_examination" text,
"diagnosis" jsonb,
"treatment_plan" text,
"prescriptions" jsonb,
"lab_tests" jsonb,
"attachments" jsonb,
"follow_up_date" date,
"is_confidential" boolean NOT NULL DEFAULT false,
"notes" text,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "receptions" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" integer UNIQUE NOT NULL,
"clinic_id" integer NOT NULL,
"full_name" varchar(255) NOT NULL,
"cpf" varchar(20) UNIQUE,
"email" varchar(255) UNIQUE NOT NULL,
"phone" varchar(50),
"is_active" boolean NOT NULL DEFAULT true,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "clinic_users" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" integer NOT NULL,
"clinic_id" integer NOT NULL,
"doctor_id" integer,
"reception_id" integer,
"role" clinic_user_role NOT NULL,
"invited_email" varchar(255),
"invitation_token" varchar(255) UNIQUE,
"invitation_expires_at" timestamp,
"accepted_at" timestamp,
"invited_by" integer,
"permissions" jsonb,
"is_active" boolean NOT NULL DEFAULT true,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "patient_assignments" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"clinic_id" integer NOT NULL,
"patient_id" integer NOT NULL,
"doctor_id" integer NOT NULL,
"is_primary" boolean NOT NULL DEFAULT false,
"assigned_by" integer,
"notes" text,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "user_registrations" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"email" varchar(255) UNIQUE NOT NULL,
"full_name" varchar(255) NOT NULL,
"clinic_name" varchar(255) NOT NULL,
"phone" varchar(50) NOT NULL,
"city_state" varchar(255) NOT NULL,
"main_specialty" varchar(255) NOT NULL,
"status" registration_status NOT NULL DEFAULT 'pending',
"approved_by" varchar(255),
"approved_at" timestamp,
"rejection_reason" text,
"google_user_id" varchar(255),
"registration_ip" varchar(50),
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "user_api_keys" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" integer NOT NULL,
"user_email" varchar(255) NOT NULL,
"api_key_hash" varchar(255) UNIQUE NOT NULL,
"status" user_api_key_status NOT NULL DEFAULT 'active',
"last_used_at" timestamp,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "audit_logs" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" integer,
"clinic_id" integer,
"action" audit_log_action NOT NULL,
"entity_type" varchar(255) NOT NULL,
"entity_id" integer,
"changes" jsonb,
"ip_address" varchar(50),
"user_agent" text,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "newsletter_subscribers" (
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"email" varchar(255) UNIQUE NOT NULL,
"full_name" varchar(255) NOT NULL,
"source" varchar(255) NOT NULL DEFAULT 'newsletter-clinica-4.0',
"status" newsletter_subscriber_status NOT NULL DEFAULT 'active',
"ip_address" varchar(50),
"user_agent" text,
"created_at" timestamp NOT NULL DEFAULT (now()),
"updated_at" timestamp NOT NULL DEFAULT (now())
);

CREATE UNIQUE INDEX ON "users" ("email");

CREATE INDEX ON "users" ("host_user_id");

CREATE UNIQUE INDEX ON "clinics" ("email");

CREATE UNIQUE INDEX ON "clinics" ("cnpj");

CREATE INDEX ON "clinic_addresses" ("clinic_id");

CREATE UNIQUE INDEX ON "doctors" ("user_id");

CREATE UNIQUE INDEX ON "doctors" ("council_number");

CREATE UNIQUE INDEX ON "doctors" ("email");

CREATE INDEX ON "doctors" ("clinic_id");

CREATE INDEX ON "patients" ("clinic_id");

CREATE UNIQUE INDEX ON "patients" ("cpf");

CREATE INDEX ON "patients" ("owning_host_id");

CREATE INDEX ON "patient_addresses" ("patient_id");

CREATE INDEX ON "emergency_contacts" ("patient_id");

CREATE UNIQUE INDEX ON "exams" ("name");

CREATE INDEX ON "appointments" ("patient_id");

CREATE INDEX ON "appointments" ("doctor_id");

CREATE INDEX ON "appointments" ("clinic_id");

CREATE INDEX ON "appointments" ("starts_at");

CREATE INDEX ON "appointments" ("ends_at");

CREATE INDEX ON "appointments" ("exam_id");

CREATE INDEX ON "appointments" ("cancelled_by");

CREATE INDEX ON "medical_records" ("patient_id");

CREATE INDEX ON "medical_records" ("doctor_id");

CREATE INDEX ON "medical_records" ("clinic_id");

CREATE INDEX ON "medical_records" ("appointment_id");

CREATE INDEX ON "medical_records" ("consultation_date");

CREATE UNIQUE INDEX ON "receptions" ("user_id");

CREATE UNIQUE INDEX ON "receptions" ("cpf");

CREATE UNIQUE INDEX ON "receptions" ("email");

CREATE INDEX ON "receptions" ("clinic_id");

CREATE UNIQUE INDEX ON "clinic_users" ("user_id", "clinic_id");

CREATE INDEX ON "clinic_users" ("user_id");

CREATE INDEX ON "clinic_users" ("clinic_id");

CREATE INDEX ON "clinic_users" ("doctor_id");

CREATE INDEX ON "clinic_users" ("reception_id");

CREATE UNIQUE INDEX ON "clinic_users" ("invitation_token");

CREATE INDEX ON "clinic_users" ("invited_by");

CREATE UNIQUE INDEX ON "patient_assignments" ("patient_id", "doctor_id");

CREATE INDEX ON "patient_assignments" ("clinic_id");

CREATE INDEX ON "patient_assignments" ("patient_id");

CREATE INDEX ON "patient_assignments" ("doctor_id");

CREATE INDEX ON "patient_assignments" ("assigned_by");

CREATE UNIQUE INDEX ON "user_registrations" ("email");

CREATE INDEX ON "user_api_keys" ("user_id");

CREATE UNIQUE INDEX ON "user_api_keys" ("api_key_hash");

CREATE INDEX ON "audit_logs" ("user_id");

CREATE INDEX ON "audit_logs" ("clinic_id");

CREATE INDEX ON "audit_logs" ("entity_type");

CREATE INDEX ON "audit_logs" ("entity_id");

CREATE INDEX ON "audit_logs" ("created_at");

CREATE UNIQUE INDEX ON "newsletter_subscribers" ("email");

COMMENT ON TABLE "users" IS 'Armazena informações gerais dos usuários do sistema.';

COMMENT ON COLUMN "users"."id" IS 'Identificador único do usuário';

COMMENT ON COLUMN "users"."email" IS 'Endereço de e-mail do usuário';

COMMENT ON COLUMN "users"."full_name" IS 'Nome completo do usuário';

COMMENT ON COLUMN "users"."password_hash" IS 'Hash da senha do usuário';

COMMENT ON COLUMN "users"."app_role" IS 'Papel principal do usuário na aplicação';

COMMENT ON COLUMN "users"."last_login" IS 'Data e hora do último login do usuário';

COMMENT ON COLUMN "users"."first_login" IS 'Indica se é o primeiro login do usuário';

COMMENT ON COLUMN "users"."is_active" IS 'Indica se o usuário está ativo';

COMMENT ON COLUMN "users"."host_user_id" IS 'Referência ao usuário host ao qual este usuário está associado, se aplicável';

COMMENT ON COLUMN "users"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "users"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "clinics" IS 'Armazena informações sobre as clínicas.';

COMMENT ON COLUMN "clinics"."id" IS 'Identificador único da clínica';

COMMENT ON COLUMN "clinics"."name" IS 'Nome da clínica';

COMMENT ON COLUMN "clinics"."cnpj" IS 'Número do CNPJ da clínica';

COMMENT ON COLUMN "clinics"."phone" IS 'Número de telefone da clínica';

COMMENT ON COLUMN "clinics"."email" IS 'Endereço de e-mail da clínica';

COMMENT ON COLUMN "clinics"."settings" IS 'Configurações diversas da clínica em formato JSON';

COMMENT ON COLUMN "clinics"."subscription_plan" IS 'Plano de assinatura da clínica';

COMMENT ON COLUMN "clinics"."is_active" IS 'Indica se a clínica está ativa';

COMMENT ON COLUMN "clinics"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "clinics"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "clinic_addresses" IS 'Armazena os endereços das clínicas.';

COMMENT ON COLUMN "clinic_addresses"."id" IS 'Identificador único do endereço da clínica';

COMMENT ON COLUMN "clinic_addresses"."clinic_id" IS 'Referência à clínica proprietária do endereço';

COMMENT ON COLUMN "clinic_addresses"."street" IS 'Nome da rua';

COMMENT ON COLUMN "clinic_addresses"."number" IS 'Número do imóvel';

COMMENT ON COLUMN "clinic_addresses"."city" IS 'Cidade';

COMMENT ON COLUMN "clinic_addresses"."state" IS 'Estado';

COMMENT ON COLUMN "clinic_addresses"."zip_code" IS 'Código postal (CEP)';

COMMENT ON COLUMN "clinic_addresses"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "clinic_addresses"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "doctors" IS 'Armazena dados específicos dos profissionais de saúde (médicos).';

COMMENT ON COLUMN "doctors"."id" IS 'Identificador único do médico';

COMMENT ON COLUMN "doctors"."user_id" IS 'Referência ao usuário associado a este médico';

COMMENT ON COLUMN "doctors"."clinic_id" IS 'Referência à clínica principal do médico';

COMMENT ON COLUMN "doctors"."full_name" IS 'Nome completo do médico';

COMMENT ON COLUMN "doctors"."cpf" IS 'Número de CPF do médico';

COMMENT ON COLUMN "doctors"."birth_date" IS 'Data de nascimento do médico';

COMMENT ON COLUMN "doctors"."gender" IS 'Gênero do médico';

COMMENT ON COLUMN "doctors"."languages" IS 'Idiomas falados pelo médico em formato JSON';

COMMENT ON COLUMN "doctors"."council_type" IS 'Tipo de conselho (ex: CRM, CRO)';

COMMENT ON COLUMN "doctors"."council_number" IS 'Número de registro no conselho profissional';

COMMENT ON COLUMN "doctors"."council_state" IS 'Estado do conselho profissional';

COMMENT ON COLUMN "doctors"."main_specialty" IS 'Especialidade médica principal';

COMMENT ON COLUMN "doctors"."sub_specialties" IS 'Sub-especialidades médicas em formato JSON';

COMMENT ON COLUMN "doctors"."email" IS 'Endereço de e-mail profissional do médico';

COMMENT ON COLUMN "doctors"."phone" IS 'Número de telefone profissional do médico';

COMMENT ON COLUMN "doctors"."landline" IS 'Número de telefone fixo do médico';

COMMENT ON COLUMN "doctors"."services" IS 'Serviços oferecidos pelo médico em formato JSON';

COMMENT ON COLUMN "doctors"."accepted_insurances" IS 'Convênios aceitos pelo médico em formato JSON';

COMMENT ON COLUMN "doctors"."availability_schedule" IS 'Disponibilidade de agenda do médico em formato JSON';

COMMENT ON COLUMN "doctors"."has_system_access" IS 'Indica se o médico tem acesso direto ao sistema';

COMMENT ON COLUMN "doctors"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "doctors"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "patients" IS 'Armazena dados dos pacientes.';

COMMENT ON COLUMN "patients"."id" IS 'Identificador único do paciente';

COMMENT ON COLUMN "patients"."clinic_id" IS 'Referência à clínica onde o paciente está registrado';

COMMENT ON COLUMN "patients"."full_name" IS 'Nome completo do paciente';

COMMENT ON COLUMN "patients"."cpf" IS 'Número de CPF do paciente';

COMMENT ON COLUMN "patients"."birth_date" IS 'Data de nascimento do paciente';

COMMENT ON COLUMN "patients"."gender" IS 'Gênero do paciente';

COMMENT ON COLUMN "patients"."phone" IS 'Número de telefone do paciente';

COMMENT ON COLUMN "patients"."email" IS 'Endereço de e-mail do paciente';

COMMENT ON COLUMN "patients"."medical_plan" IS 'Plano de saúde do paciente';

COMMENT ON COLUMN "patients"."allergies" IS 'Lista de alergias do paciente em formato JSON';

COMMENT ON COLUMN "patients"."chronic_conditions" IS 'Condições crônicas do paciente em formato JSON';

COMMENT ON COLUMN "patients"."current_medications" IS 'Medicamentos em uso pelo paciente em formato JSON';

COMMENT ON COLUMN "patients"."surgeries" IS 'Histórico de cirurgias do paciente em formato JSON';

COMMENT ON COLUMN "patients"."hospitalizations" IS 'Histórico de internações do paciente em formato JSON';

COMMENT ON COLUMN "patients"."family_medical_history" IS 'Histórico médico familiar do paciente';

COMMENT ON COLUMN "patients"."is_active" IS 'Indica se o paciente está ativo';

COMMENT ON COLUMN "patients"."owning_host_id" IS 'Referência ao usuário host responsável pelo paciente';

COMMENT ON COLUMN "patients"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "patients"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "patient_addresses" IS 'Armazena os endereços dos pacientes.';

COMMENT ON COLUMN "patient_addresses"."id" IS 'Identificador único do endereço do paciente';

COMMENT ON COLUMN "patient_addresses"."patient_id" IS 'Referência ao paciente proprietário do endereço';

COMMENT ON COLUMN "patient_addresses"."street" IS 'Nome da rua';

COMMENT ON COLUMN "patient_addresses"."number" IS 'Número do imóvel';

COMMENT ON COLUMN "patient_addresses"."city" IS 'Cidade';

COMMENT ON COLUMN "patient_addresses"."state" IS 'Estado';

COMMENT ON COLUMN "patient_addresses"."zip_code" IS 'Código postal (CEP)';

COMMENT ON COLUMN "patient_addresses"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "patient_addresses"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "emergency_contacts" IS 'Armazena contatos de emergência dos pacientes.';

COMMENT ON COLUMN "emergency_contacts"."id" IS 'Identificador único do contato de emergência';

COMMENT ON COLUMN "emergency_contacts"."patient_id" IS 'Referência ao paciente do contato de emergência';

COMMENT ON COLUMN "emergency_contacts"."name" IS 'Nome completo do contato de emergência';

COMMENT ON COLUMN "emergency_contacts"."phone" IS 'Número de telefone do contato de emergência';

COMMENT ON COLUMN "emergency_contacts"."relationship" IS 'Parentesco ou relação com o paciente';

COMMENT ON COLUMN "emergency_contacts"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "emergency_contacts"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "exams" IS 'Catálogo de exames oferecidos pelas clínicas.';

COMMENT ON COLUMN "exams"."id" IS 'Identificador único do exame';

COMMENT ON COLUMN "exams"."name" IS 'Nome do exame';

COMMENT ON COLUMN "exams"."category" IS 'Categoria do exame (ex: Laboratorial, Imagem)';

COMMENT ON COLUMN "exams"."instructions" IS 'Instruções detalhadas para o exame';

COMMENT ON COLUMN "exams"."notes" IS 'Notas adicionais sobre o exame';

COMMENT ON COLUMN "exams"."price" IS 'Preço do exame';

COMMENT ON COLUMN "exams"."duration" IS 'Duração padrão do exame em minutos';

COMMENT ON COLUMN "exams"."status" IS 'Status do exame (ativo, arquivado)';

COMMENT ON COLUMN "exams"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "exams"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "appointments" IS 'Armazena informações sobre agendamentos e consultas.';

COMMENT ON COLUMN "appointments"."id" IS 'Identificador único do agendamento';

COMMENT ON COLUMN "appointments"."patient_id" IS 'Referência ao paciente agendado';

COMMENT ON COLUMN "appointments"."doctor_id" IS 'Referência ao médico responsável pelo agendamento';

COMMENT ON COLUMN "appointments"."clinic_id" IS 'Referência à clínica onde o agendamento ocorrerá';

COMMENT ON COLUMN "appointments"."exam_id" IS 'Referência ao exame, se o agendamento for para um exame';

COMMENT ON COLUMN "appointments"."starts_at" IS 'Data e hora de início do agendamento';

COMMENT ON COLUMN "appointments"."ends_at" IS 'Data e hora de término do agendamento';

COMMENT ON COLUMN "appointments"."duration" IS 'Duração do agendamento em minutos';

COMMENT ON COLUMN "appointments"."type" IS 'Tipo de agendamento (consulta, exame, etc.)';

COMMENT ON COLUMN "appointments"."status" IS 'Status atual do agendamento';

COMMENT ON COLUMN "appointments"."source" IS 'Fonte de onde o agendamento foi feito';

COMMENT ON COLUMN "appointments"."specialty" IS 'Especialidade do agendamento';

COMMENT ON COLUMN "appointments"."special_needs" IS 'Necessidades especiais do paciente para o agendamento';

COMMENT ON COLUMN "appointments"."whatsapp_thread" IS 'ID do thread do WhatsApp para comunicação';

COMMENT ON COLUMN "appointments"."reminder_sent" IS 'Indica se o lembrete foi enviado';

COMMENT ON COLUMN "appointments"."cancellation_reason" IS 'Motivo do cancelamento, se aplicável';

COMMENT ON COLUMN "appointments"."cancelled_by" IS 'Usuário que cancelou o agendamento';

COMMENT ON COLUMN "appointments"."notes" IS 'Notas adicionais sobre o agendamento';

COMMENT ON COLUMN "appointments"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "appointments"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "medical_records" IS 'Armazena prontuários e histórico médico dos pacientes.';

COMMENT ON COLUMN "medical_records"."id" IS 'Identificador único do prontuário médico';

COMMENT ON COLUMN "medical_records"."patient_id" IS 'Referência ao paciente do prontuário';

COMMENT ON COLUMN "medical_records"."doctor_id" IS 'Referência ao médico que criou/atualizou o prontuário';

COMMENT ON COLUMN "medical_records"."clinic_id" IS 'Referência à clínica onde o prontuário foi gerado';

COMMENT ON COLUMN "medical_records"."appointment_id" IS 'Referência ao agendamento associado a este prontuário';

COMMENT ON COLUMN "medical_records"."consultation_date" IS 'Data da consulta médica';

COMMENT ON COLUMN "medical_records"."chief_complaint" IS 'Queixa principal do paciente';

COMMENT ON COLUMN "medical_records"."history_present_illness" IS 'História da doença atual';

COMMENT ON COLUMN "medical_records"."physical_examination" IS 'Exame físico realizado';

COMMENT ON COLUMN "medical_records"."diagnosis" IS 'Diagnóstico médico em formato JSON (pode ser múltiplos)';

COMMENT ON COLUMN "medical_records"."treatment_plan" IS 'Plano de tratamento prescrito';

COMMENT ON COLUMN "medical_records"."prescriptions" IS 'Medicamentos prescritos em formato JSON';

COMMENT ON COLUMN "medical_records"."lab_tests" IS 'Resultados de exames laboratoriais em formato JSON';

COMMENT ON COLUMN "medical_records"."attachments" IS 'Anexos relacionados ao prontuário em formato JSON (ex: links para documentos)';

COMMENT ON COLUMN "medical_records"."follow_up_date" IS 'Data de acompanhamento recomendada';

COMMENT ON COLUMN "medical_records"."is_confidential" IS 'Indica se o prontuário é confidencial';

COMMENT ON COLUMN "medical_records"."notes" IS 'Notas adicionais no prontuário';

COMMENT ON COLUMN "medical_records"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "medical_records"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "receptions" IS 'Armazena dados específicos das recepcionistas.';

COMMENT ON COLUMN "receptions"."id" IS 'Identificador único da recepcionista';

COMMENT ON COLUMN "receptions"."user_id" IS 'Referência ao usuário associado a esta recepcionista';

COMMENT ON COLUMN "receptions"."clinic_id" IS 'Referência à clínica onde a recepcionista trabalha';

COMMENT ON COLUMN "receptions"."full_name" IS 'Nome completo da recepcionista';

COMMENT ON COLUMN "receptions"."cpf" IS 'Número de CPF da recepcionista';

COMMENT ON COLUMN "receptions"."email" IS 'Endereço de e-mail da recepcionista';

COMMENT ON COLUMN "receptions"."phone" IS 'Número de telefone da recepcionista (pode ser um telefone de trabalho)';

COMMENT ON COLUMN "receptions"."is_active" IS 'Indica se a recepcionista está ativa';

COMMENT ON COLUMN "receptions"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "receptions"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "clinic_users" IS 'Vincula usuários a clínicas e define seus papéis específicos dentro de cada clínica.';

COMMENT ON COLUMN "clinic_users"."id" IS 'Identificador único da associação usuário-clínica';

COMMENT ON COLUMN "clinic_users"."user_id" IS 'Referência ao usuário';

COMMENT ON COLUMN "clinic_users"."clinic_id" IS 'Referência à clínica';

COMMENT ON COLUMN "clinic_users"."doctor_id" IS 'Referência ao registro de médico, se o usuário for um médico';

COMMENT ON COLUMN "clinic_users"."reception_id" IS 'Referência ao registro de recepcionista, se o usuário for uma recepcionista';

COMMENT ON COLUMN "clinic_users"."role" IS 'Papel do usuário dentro desta clínica específica';

COMMENT ON COLUMN "clinic_users"."invited_email" IS 'E-mail para o qual o convite foi enviado';

COMMENT ON COLUMN "clinic_users"."invitation_token" IS 'Token único para aceitar o convite';

COMMENT ON COLUMN "clinic_users"."invitation_expires_at" IS 'Data de expiração do convite';

COMMENT ON COLUMN "clinic_users"."accepted_at" IS 'Data em que o convite foi aceito';

COMMENT ON COLUMN "clinic_users"."invited_by" IS 'Referência ao usuário que enviou o convite';

COMMENT ON COLUMN "clinic_users"."permissions" IS 'Permissões específicas do usuário nesta clínica em formato JSON';

COMMENT ON COLUMN "clinic_users"."is_active" IS 'Indica se o usuário está ativo nesta clínica';

COMMENT ON COLUMN "clinic_users"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "clinic_users"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "patient_assignments" IS 'Gerencia a atribuição de pacientes a médicos dentro de uma clínica.';

COMMENT ON COLUMN "patient_assignments"."id" IS 'Identificador único da atribuição de paciente a médico';

COMMENT ON COLUMN "patient_assignments"."clinic_id" IS 'Referência à clínica onde a atribuição ocorre';

COMMENT ON COLUMN "patient_assignments"."patient_id" IS 'Referência ao paciente atribuído';

COMMENT ON COLUMN "patient_assignments"."doctor_id" IS 'Referência ao médico atribuído';

COMMENT ON COLUMN "patient_assignments"."is_primary" IS 'Indica se este é o médico principal do paciente na clínica';

COMMENT ON COLUMN "patient_assignments"."assigned_by" IS 'Usuário que realizou a atribuição';

COMMENT ON COLUMN "patient_assignments"."notes" IS 'Notas sobre a atribuição';

COMMENT ON COLUMN "patient_assignments"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "patient_assignments"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "user_registrations" IS 'Registra solicitações de acesso para novos usuários, especialmente hosts.';

COMMENT ON COLUMN "user_registrations"."id" IS 'Identificador único do registro de usuário';

COMMENT ON COLUMN "user_registrations"."email" IS 'Endereço de e-mail do solicitante';

COMMENT ON COLUMN "user_registrations"."full_name" IS 'Nome completo do solicitante';

COMMENT ON COLUMN "user_registrations"."clinic_name" IS 'Nome da clínica que o solicitante deseja associar';

COMMENT ON COLUMN "user_registrations"."phone" IS 'Número de telefone do solicitante';

COMMENT ON COLUMN "user_registrations"."city_state" IS 'Cidade e estado do solicitante';

COMMENT ON COLUMN "user_registrations"."main_specialty" IS 'Especialidade principal do solicitante (se for médico)';

COMMENT ON COLUMN "user_registrations"."status" IS 'Status da solicitação de registro';

COMMENT ON COLUMN "user_registrations"."approved_by" IS 'E-mail do administrador que aprovou o registro';

COMMENT ON COLUMN "user_registrations"."approved_at" IS 'Data e hora da aprovação do registro';

COMMENT ON COLUMN "user_registrations"."rejection_reason" IS 'Motivo da rejeição do registro';

COMMENT ON COLUMN "user_registrations"."google_user_id" IS 'ID do usuário Google, se o registro for via Google';

COMMENT ON COLUMN "user_registrations"."registration_ip" IS 'Endereço IP de onde o registro foi feito';

COMMENT ON COLUMN "user_registrations"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "user_registrations"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "user_api_keys" IS 'Gerencia chaves de API personalizadas para usuários.';

COMMENT ON COLUMN "user_api_keys"."id" IS 'Identificador único da chave de API';

COMMENT ON COLUMN "user_api_keys"."user_id" IS 'Referência ao usuário proprietário da chave de API';

COMMENT ON COLUMN "user_api_keys"."user_email" IS 'E-mail do usuário proprietário da chave de API';

COMMENT ON COLUMN "user_api_keys"."api_key_hash" IS 'Hash da chave de API (nunca armazenar a chave em texto claro)';

COMMENT ON COLUMN "user_api_keys"."status" IS 'Status da chave de API (ativa, revogada)';

COMMENT ON COLUMN "user_api_keys"."last_used_at" IS 'Data e hora do último uso da chave de API';

COMMENT ON COLUMN "user_api_keys"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "user_api_keys"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "audit_logs" IS 'Registra ações importantes no sistema para fins de auditoria.';

COMMENT ON COLUMN "audit_logs"."id" IS 'Identificador único do log de auditoria';

COMMENT ON COLUMN "audit_logs"."user_id" IS 'Referência ao usuário que realizou a ação (pode ser nulo para ações do sistema)';

COMMENT ON COLUMN "audit_logs"."clinic_id" IS 'Referência à clínica onde a ação ocorreu, se aplicável';

COMMENT ON COLUMN "audit_logs"."action" IS 'Descrição da ação realizada (ex: CREATE_USER, UPDATE_PATIENT)';

COMMENT ON COLUMN "audit_logs"."entity_type" IS 'Tipo da entidade afetada (ex: User, Clinic, Patient)';

COMMENT ON COLUMN "audit_logs"."entity_id" IS 'ID da entidade afetada';

COMMENT ON COLUMN "audit_logs"."changes" IS 'Detalhes das mudanças realizadas em formato JSON';

COMMENT ON COLUMN "audit_logs"."ip_address" IS 'Endereço IP de onde a ação foi realizada';

COMMENT ON COLUMN "audit_logs"."user_agent" IS 'User-Agent do navegador/aplicação que realizou a ação';

COMMENT ON COLUMN "audit_logs"."created_at" IS 'Data e hora em que a ação ocorreu';

COMMENT ON COLUMN "audit_logs"."updated_at" IS 'Data da última atualização do registro';

COMMENT ON TABLE "newsletter_subscribers" IS 'Gerencia as inscrições para a newsletter.';

COMMENT ON COLUMN "newsletter_subscribers"."id" IS 'Identificador único do assinante da newsletter';

COMMENT ON COLUMN "newsletter_subscribers"."email" IS 'Endereço de e-mail do assinante';

COMMENT ON COLUMN "newsletter_subscribers"."full_name" IS 'Nome completo do assinante';

COMMENT ON COLUMN "newsletter_subscribers"."source" IS 'Fonte de onde o assinante se inscreveu';

COMMENT ON COLUMN "newsletter_subscribers"."status" IS 'Status da assinatura (ativo, cancelado)';

COMMENT ON COLUMN "newsletter_subscribers"."ip_address" IS 'Endereço IP de onde a inscrição foi feita';

COMMENT ON COLUMN "newsletter_subscribers"."user_agent" IS 'User-Agent do navegador/aplicação que realizou a inscrição';

COMMENT ON COLUMN "newsletter_subscribers"."created_at" IS 'Data de criação do registro';

COMMENT ON COLUMN "newsletter_subscribers"."updated_at" IS 'Data da última atualização do registro';

ALTER TABLE "users" ADD FOREIGN KEY ("host_user_id") REFERENCES "users" ("id");

ALTER TABLE "clinic_addresses" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "doctors" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "doctors" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "patients" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "patients" ADD FOREIGN KEY ("owning_host_id") REFERENCES "users" ("id");

ALTER TABLE "patient_addresses" ADD FOREIGN KEY ("patient_id") REFERENCES "patients" ("id");

ALTER TABLE "emergency_contacts" ADD FOREIGN KEY ("patient_id") REFERENCES "patients" ("id");

ALTER TABLE "appointments" ADD FOREIGN KEY ("patient_id") REFERENCES "patients" ("id");

ALTER TABLE "appointments" ADD FOREIGN KEY ("doctor_id") REFERENCES "doctors" ("id");

ALTER TABLE "appointments" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "appointments" ADD FOREIGN KEY ("exam_id") REFERENCES "exams" ("id");

ALTER TABLE "appointments" ADD FOREIGN KEY ("cancelled_by") REFERENCES "users" ("id");

ALTER TABLE "medical_records" ADD FOREIGN KEY ("patient_id") REFERENCES "patients" ("id");

ALTER TABLE "medical_records" ADD FOREIGN KEY ("doctor_id") REFERENCES "doctors" ("id");

ALTER TABLE "medical_records" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "medical_records" ADD FOREIGN KEY ("appointment_id") REFERENCES "appointments" ("id");

ALTER TABLE "receptions" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "receptions" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "clinic_users" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "clinic_users" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "clinic_users" ADD FOREIGN KEY ("doctor_id") REFERENCES "doctors" ("id");

ALTER TABLE "clinic_users" ADD FOREIGN KEY ("reception_id") REFERENCES "receptions" ("id");

ALTER TABLE "clinic_users" ADD FOREIGN KEY ("invited_by") REFERENCES "users" ("id");

ALTER TABLE "patient_assignments" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");

ALTER TABLE "patient_assignments" ADD FOREIGN KEY ("patient_id") REFERENCES "patients" ("id");

ALTER TABLE "patient_assignments" ADD FOREIGN KEY ("doctor_id") REFERENCES "doctors" ("id");

ALTER TABLE "patient_assignments" ADD FOREIGN KEY ("assigned_by") REFERENCES "users" ("id");

ALTER TABLE "user_api_keys" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "audit_logs" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "audit_logs" ADD FOREIGN KEY ("clinic_id") REFERENCES "clinics" ("id");